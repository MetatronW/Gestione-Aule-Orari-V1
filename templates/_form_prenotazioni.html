<div class="bg-white border-transparent rounded-lg shadow-xl p-6">
    <div class="bg-gradient-to-b from-green-300 to-green-100 uppercase text-gray-800 border-b-2 border-green-300 rounded-tl-lg rounded-tr-lg p-3 mb-4">
        <h2 class="font-bold uppercase text-green-900">
            <i class="fas fa-calendar-plus"></i> Nuova Prenotazione Aula/Laboratorio
        </h2>
    </div>
    {% if messaggio_successo %}
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
            <strong class="font-bold">Successo!</strong>
            <span class="block sm:inline">{{ messaggio_successo }}</span>
        </div>
    {% endif %}
    {% if errore %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
            <strong class="font-bold">Errore!</strong>
            <span class="block sm:inline">{{ errore }}</span>
        </div>
    {% endif %}
    <form method="POST" action="{{ url_for('inserisci_materie') }}" class="space-y-4">
        
        <div class="form-group">
            <label for="id_materia" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-book text-green-600"></i> Seleziona Materia
            </label>
            <select name="id_materia" id="id_materia" required 
                     class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md border">
                <option value="">-- Seleziona una materia --</option>
                {% for materia in materie %}
                <option value="{{ materia[0] }}">{{ materia[1] }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="id_aula" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-door-open text-green-600"></i> Seleziona Aula/Laboratorio
            </label>
            <select name="id_aula" id="id_aula" required 
                     onchange="checkDisponibilita()"
                    class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md border">
                <option value="">-- Seleziona un'aula --</option>
                {% for aula in aule %}
                <option value="{{ aula[0] }}">
                    {{ aula[1] }} ({{ aula[2]|upper }}) - Capacità: {{ aula[3] }} posti
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-calendar-alt text-green-600"></i> Seleziona Date (Selezione Multipla)
            </label>
            <div class="bg-gray-50 border border-gray-300 rounded-md p-4">
                <div id="date-container" class="space-y-2">
                    <div class="date-input-row flex items-center space-x-2">
                        <input type="date" name="date_prenotazioni[]" required
                                onchange="checkDisponibilita()"
                               class="date-input flex-1 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md border">
                        <button type="button" onclick="removeDate(this)" class="hidden bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <button type="button" onclick="addDateInput()"
                         class="mt-3 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded inline-flex items-center text-sm">
                    <i class="fas fa-plus mr-2"></i>
                    Aggiungi Altra Data
                </button>
            </div>
            <p class="text-xs text-gray-500 mt-2">
                <i class="fas fa-info-circle"></i> Puoi selezionare più date per prenotare la stessa aula/materia in giorni diversi
            </p>
        </div>
        
        <div class="form-group">
            <label for="fascia_oraria" class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-clock text-green-600"></i> Fascia Oraria (Selezione Multipla)
            </label>
            <select name="fascia_oraria[]" id="fascia_oraria" required multiple size="10"
                    class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md border">
                <option value="08-09">08:00 - 09:00</option>
                <option value="09-10">09:00 - 10:00</option>
                <option value="10-11">10:00 - 11:00</option>
                <option value="11-12">11:00 - 12:00</option>
                <option value="12-13">12:00 - 13:00</option>
                <option value="13-14">13:00 - 14:00</option> 
                <option value="14-15">14:00 - 15:00</option>
                <option value="15-16">15:00 - 16:00</option>
                <option value="16-17">16:00 - 17:00</option>
                <option value="17-18">17:00 - 18:00</option>
                <option value="18-19">18:00 - 19:00</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">
                <i class="fas fa-info-circle"></i>
                 <span class="text-green-600">✓ = Disponibile</span>, <span class="text-red-600">✗ = Occupata</span>
            </p>
            <p class="text-xs text-gray-500 mt-1">
                <i class="fas fa-info-circle"></i>
                 <span class="text-green-600">Nel caso di selezione multipla delle date, verranno mostrate solo le fasce orarie disponibili in COMUNE a tutte le date inserite.</span>
            </p>
        </div>
        
        <div class="flex items-center justify-end space-x-3 pt-4">
            <a href="{{ url_for('dashboard') }}"
                class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded inline-flex items-center">
                <i class="fas fa-times mr-2"></i>
                Annulla
            </a>
            <button type="submit"
                     class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-flex items-center">
                <i class="fas fa-save mr-2"></i>
                Salva Prenotazione
            </button>
        </div>
    </form>
</div>
<!-- loader -->
<div id="loader-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col items-center">
        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
        <p class="text-gray-700 font-semibold">Salvataggio in corso...</p>
    </div>
</div>