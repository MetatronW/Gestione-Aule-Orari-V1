{% extends "base.html" %}

{% block title %}ORARI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<!-- HEADER PAGINA -->
<div class="bg-gray-800 pt-3">
    <div class="rounded-tl-3xl bg-gradient-to-r from-blue-900 to-gray-800 p-4 shadow text-2xl text-white">
        <h1 class="font-bold pl-2">
            <i class="fas fa-calendar-alt"></i> ORARI AULE E LABORATORI
        </h1>
    </div>
</div>

<!-- FORM SELEZIONE DATA -->
<div class="flex flex-wrap p-6">
    <div class="w-full md:w-1/2 xl:w-1/3">
        <div class="bg-white border-b-4 border-blue-500 rounded-lg shadow-xl p-5">
            <form method="GET" action="{{ url_for('dashboard') }}">
                <div class="flex flex-col items-start">
                    <h2 class="font-bold uppercase text-gray-700 mb-3">
                        <i class="fas fa-calendar-day text-blue-600"></i> Seleziona Data
                    </h2>
                    <div class="w-full flex space-x-2">
                        <input type="date" name="data" value="{{ data_selezionata }}" 
                               class="form-input flex-1 border border-gray-400 p-2 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                            <i class="fas fa-search"></i> Cerca
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {% if data_selezionata %}
    <div class="w-full md:w-1/2 xl:w-2/3 md:pl-6">
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded" role="alert">
            <p class="font-bold"><i class="fas fa-info-circle"></i> Info Data</p>
            <p class="text-sm">Prenotazioni per il giorno: <strong>{{ data_selezionata }}</strong></p>
        </div>
    </div>
    {% endif %}
</div>

<!-- TABELLA ORARI -->
{% if data_selezionata %}
<div class="flex flex-wrap px-6 pb-6">
    <div class="w-full">
        <div class="bg-white border-transparent rounded-lg shadow-xl">
            <div class="bg-gradient-to-b from-blue-300 to-blue-100 uppercase text-gray-800 border-b-2 border-blue-300 rounded-tl-lg rounded-tr-lg p-3">
                <h2 class="font-bold uppercase text-blue-900">
                    <i class="fas fa-table"></i> Griglia Oraria - {{ data_selezionata }}
                </h2>
            </div>
            
            <div class="p-5 table-container">
                <table class="w-full orari-table">
                    <thead>
                        <tr>
                            <th class="fascia-oraria">ORARIO</th>
                            {% for aula in aule %}
                            <th>{{ aula[1] }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for fascia in fasce_orarie %}
                        <tr>
                            {% if fascia == '13-14' %}
                            <td class="pausa-pranzo">{{ fascia }}</td>
                            <td colspan="{{ aule|length }}" class="pausa-pranzo">
                                üçΩÔ∏è PAUSA PRANZO
                            </td>
                            {% else %}
                            <td class="fascia-oraria">{{ fascia }}</td>
                            {% for aula in aule %}
                                {% set prenotazione = griglia_oraria.get((fascia, aula[0])) %}
                                {% if prenotazione %}
                                <td>
                                    <div class="materia-cell">
                                        {{ prenotazione.nome_materia }}
                                    </div>
                                </td>
                                {% else %}
                                <td class="empty-cell"></td>
                                {% endif %}
                            {% endfor %}
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% if not griglia_oraria %}
            <div class="p-5 text-center text-gray-500">
                <i class="fas fa-calendar-times text-4xl mb-3"></i>
                <p class="text-lg">Nessuna prenotazione trovata per questa data.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% else %}
<div class="flex flex-wrap px-6 pb-6">
    <div class="w-full">
        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded" role="alert">
            <p class="font-bold"><i class="fas fa-exclamation-triangle"></i> Nessuna data selezionata</p>
            <p>Seleziona una data dal calendario per visualizzare gli orari delle prenotazioni.</p>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}